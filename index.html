<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mint NFT</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.0/dist/ethers.umd.min.js"></script>  <!-- کتابخانه ethers.js -->
</head>
<body>
    <h1>Mint Your NFT</h1>
    <button id="connect-wallet">Connect Wallet</button>
    <button id="mint-nft" style="display:none;">Mint NFT</button>

    <script>
        // مرحله 1: اتصال به کیف پول
        let userAddress;
        let provider;
        let signer;

        async function connectWallet() {
            if (window.ethereum) {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                console.log("Connected address:", userAddress);
                document.getElementById('mint-nft').style.display = 'block';  // نمایش دکمه مینت بعد از اتصال
            } else {
                alert("Please install MetaMask!");
            }
        }

        // مرحله 2: وقتی پرداخت تایید شد، NFT را ارسال کن
        async function mintNFT() {
            const paymentUrl = 'https://your-vercel-project-url.vercel.app/api/webhook';  // URL سرور شما که در Vercel ساخته‌اید

            // ارسال درخواست به سرور
            const response = await fetch(paymentUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    address: userAddress,  // آدرس کیف پول کاربر
                    tokenId: 123,  // شناسه NFT که می‌خواهید ارسال کنید
                }),
            });

            const result = await response.json();
            if (result.status === 'success') {
                alert('NFT has been sent to your wallet!');
            } else {
                alert('Something went wrong. Try again!');
            }
        }

        // اتصال دکمه‌ها
        document.getElementById('connect-wallet').addEventListener('click', connectWallet);
        document.getElementById('mint-nft').addEventListener('click', mintNFT);
    </script>
</body>
</html>